<head>
    <script src="https://data.bvid.fun/lib/base64.js"></script>
    <script src="https://data.bvid.fun/lib/axios.min.js"></script>
    <script>
        function setVid(bself){
            var strcollection=bself.value.split("|");
            console.log(strcollection[0]);
            document.getElementById("vplayer").src=strcollection[1];
            document.getElementById("downbutton").setAttribute("onclick","location.href=\""+strcollection[2]+"\"");
        };
    </script>
    
</head>
<body style="margin: 0;background-color: rgba(255, 255, 255, 0.300);">
    <div id="title" style="width: 100%;margin: 0;font-size: small;line-height: 2.5vh;color: black;position:fixed;background-color: #bed5ff;height: 2.5%;">　Player</div>
    <div style="height: 2.5%;"></div>
    <div id="main" style="height: 97.5%;position: fixed;width: 100%;overflow-y: scroll;border-top: solid 1px;">
        <center><video id="vplayer" style="border: solid 1px;margin: 0;width: 109vh;margin-top: 5%;" controls src="https://data.bvid.fun/Sample.mp4" controllist="nodownload">抱歉 您的浏览器不支持HTML5。</video></center>
        <center>
            <div id="infobar" style="width: 109vh;margin: 0;margin-top: 5%;display: flex;margin-bottom: 3%;">
                <div style="width: 20%;"><img id="picdata" src="" alt="#暂无图片#" width="100%"></div>
                <div style="margin:0;margin-left:2%;width: 50%;border-right: solid 1px rgb(220, 220, 220);height: fit-content;">
                    <h1 id="b_title" style="text-align: left;margin-top: 0;margin-right: 2%;"></h1>
                    <p id="b_status" style="text-align: left;font-size: xx-small;color: rgb(140, 140, 140);margin-right: 2%;"></p>
                    <p id="b_info" style="text-align: left;font-size: smaller;margin-right: 2%;"></p>
                </div>
                <div style="margin: 0;width: 28%;">
                    <p style="font-size: xx-small;">本资源由 <a id="provider" href=""></a> 上传</p>
                    <div style="width:70%;margin-top: 7%;">
                        <p style="text-align: left;font-size: xx-small;color: rgb(140, 140, 140);margin: 0;margin-bottom: 2px;">选集：</p>
                        <div style="height: 20px;"><select id="EP_select" onchange="setVid(this)" style="width: 75%;height: 100%;"></select><button id="downbutton" style="width: 25%;font-size: xx-small;margin-top: 1px;">下载</button></div>
                    </div>
                </div>
            </div>
        </center>
        <hr style="width: 109vh;background-color: rgb(220, 220, 220);height: 1px;border: none;">
        <script id="comments" src="https://utteranc.es/client.js"
            repo="SomeFreakingAnime/SFAComments"
            issue-term=""
            theme="github-light"
            crossorigin="anonymous"
            async>
        </script>
        <div style="width: 100%;height: 5%;"></div>
    </div>
    
    <script>
        function getUrlParam (name) {
            var reg = new RegExp("(^|&)" + name + "=([^&]*)(&|$)");
            var r = window.location.search.substr(1).match(reg);
            if (r!= null) {
            	return unescape(r[2]);
            }else{
            	return null;
            }
        };
        var JSON=getUrlParam("JSON");
        var EP=getUrlParam("EP");
        if(EP==undefined){EP=1;}else{EP=Number(EP);};
        JSON = "/BANGUMI/"+JSON+".json";
        document.getElementById("comments").setAttribute("issue-term",JSON);
        axios.get(JSON).then(function(response){
            var DATA=eval("("+response.data+")");
            document.getElementById("picdata").src=DATA.PIC;
            document.getElementById("b_info").innerText=DATA.INFO;
            document.getElementById("b_title").innerText=DATA.BANGUMI_NAME;
            var b_status="";
            switch (DATA.TYPE) {
                case 0:
                    b_status+="TV动画    "
                    break;
            
                default:
                    break;
            };
            b_status+=(DATA.REGION+"    "+DATA.DATE+"    ");
            if(DATA.IF_COMPLETE==true){
                b_status+=("已完结  共"+String(DATA.EP_COUNT)+"话  ");
            }else{b_status+="连载中  ";};
            document.getElementById("b_status").innerText=b_status;
            document.getElementById("provider").href="mailto:"+DATA.PROVIDER;
            document.getElementById("provider").innerText=DATA.PROVIDER_NAME;
            for(loop=1;loop<=DATA.EP_COUNT;loop++){
                var ep=''
                if(loop<=9){ep="0"+String(loop)}else{ep=String(loop)};
                var buttontext="EP"+ep+" ("+String(DATA.EP[loop].RES)+"p)";
                var playb=document.createElement("option");
                var bvalue=ep+"|"+DATA.EP[loop].VID+"|"+DATA.EP[loop].DOWN;
                playb.innerText=buttontext;
                playb.setAttribute("value",bvalue);
                document.getElementById("EP_select").appendChild(playb);
                if(loop==EP){document.getElementById("EP_select").value=bvalue;};
                if(loop==DATA.EP_COUNT){setVid(document.getElementById("EP_select"));};
            }

            setTimeout(() => {
                if(window.self === window.top) {if(window.location.host=="some.freakinganime.online"){location.href="https://some.freakinganime.online";};}
                
            }, 5000); 
            
        });
    </script>
</body>